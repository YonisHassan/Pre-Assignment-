# Spring Boot Deployment Session - 06/01/2026

## Overview
Attempted to deploy a Spring Boot application (LibraryProject2) on a fresh Ubuntu AWS EC2 instance. The application is a Java-MySQL library management system with both a web UI and REST API.

## What We Accomplished

### 1. Environment Setup
- Updated system packages (`apt update`)
- Installed Java 17 (OpenJDK 17)
- Installed Maven build tool
- Installed MySQL server

### 2. Project Structure
- Located the project in `~/Spring/Spring-boot/LibraryProject2`
- Identified it as a Maven-based Spring Boot application
- Found configuration requirements in README.md
- Application runs on port 5000 (not default 8080)

### 3. Database Configuration
- Created MySQL database: `library`
- Loaded database schema from `library.sql`
- Attempted to create database user with appropriate permissions

### 4. Environment Variables Setup
According to the application requirements, three environment variables are needed:
- `DB_HOST`: JDBC connection string for MySQL database
- `DB_USER`: Database username
- `DB_PASS`: Database password

## Challenges Faced

### Challenge 1: Maven Plugin Not Found
**Error:** `No plugin found for prefix 'spring-boot'`

**Cause:** Running Maven commands from wrong directory - `pom.xml` was located in `LibraryProject2` subdirectory, not the parent directory.

**Solution:** Navigate to the correct directory containing `pom.xml`:
```bash
cd ~/Spring/Spring-boot/LibraryProject2
```

### Challenge 2: MySQL Password Policy
**Error:** `Your password does not satisfy the current policy requirements`

**Issue:** MySQL's default password validation policy rejected weak passwords.

**Attempted Solution:** Used a stronger password that meets MySQL's complexity requirements (uppercase, lowercase, numbers, special characters).

**Status:** User creation appeared successful, but authentication issues persisted.

### Challenge 3: Database Connection Failure
**Error:** `Access denied for user at localhost (using password: YES)`

**Possible Causes:**
1. User wasn't created properly due to earlier GRANT error
2. Password mismatch between what's set in MySQL vs environment variables
3. MySQL user permissions not properly configured

**Status:** Unresolved at end of session.

### Challenge 4: Application Configuration
The application expects environment variables rather than hardcoded values in `application.properties`. This is a common production practice but requires proper shell configuration.

## Key Learnings

### Linux Command Chaining Operators

Understanding how to chain commands is crucial for efficient shell usage:

#### 1. Semicolon (`;`) - Sequential Execution
```bash
command1 ; command2 ; command3
```
- Executes commands **one after another**
- Each command runs **regardless** of whether previous commands succeeded or failed
- Useful when you want all commands to run no matter what

**Example:**
```bash
cd /tmp ; ls ; pwd
```
Even if `cd` fails, `ls` and `pwd` will still execute.

#### 2. Double Ampersand (`&&`) - Conditional AND
```bash
command1 && command2 && command3
```
- Executes commands **only if the previous command succeeded** (exit code 0)
- Stops at the first failure
- Useful for dependent operations where later steps require earlier steps to succeed

**Example:**
```bash
cd ~/project && mvn clean && mvn install
```
If `cd` fails, Maven commands won't run. If `mvn clean` fails, `mvn install` won't run.

#### 3. Double Pipe (`||`) - Conditional OR
```bash
command1 || command2 || command3
```
- Executes the **next command only if the previous command failed** (non-zero exit code)
- Stops at the first success
- Useful for fallback operations or error handling

**Example:**
```bash
ping google.com || ping 8.8.8.8 || echo "No network connection"
```
If first ping succeeds, nothing else runs. If it fails, try second ping. If that fails, print message.

#### Practical Comparison
```bash
# Using ; (all commands run)
mkdir /root/test ; cd /root/test ; touch file.txt
# Result: mkdir fails (permission denied), but cd and touch still attempt to run

# Using && (stops on failure)
mkdir /root/test && cd /root/test && touch file.txt
# Result: mkdir fails, so cd and touch never execute

# Using || (fallback on failure)
cd /existing/dir || cd /home || cd /tmp
# Result: Tries first directory, if fails tries second, if fails tries third
```

### Maven Build Lifecycle
- `mvn spring-boot:run` - Runs the application in foreground (blocks terminal)
- `mvn spring-boot:start` - Runs the application in background
- `mvn spring-boot:stop` - Stops background application
- `mvn clean` - Cleans build artifacts
- `mvn package` - Compiles and packages the application (creates JAR file)

### Spring Boot Configuration Methods
1. **application.properties** - Hardcoded configuration (not recommended for sensitive data)
2. **Environment Variables** - Used in this project (better for production)
3. **Command-line arguments** - Can override properties at runtime

### MySQL Security
- Modern MySQL enforces password policies by default
- Weak passwords are rejected to improve security
- User creation and permission granting are separate operations

## Current Status

### What's Working ✓
- Java 17 installed and verified
- Maven installed and verified
- MySQL server running
- Database `library` created
- Database schema loaded from SQL file
- Environment variables set in current shell session
- Application compiles successfully

### What's Not Working ✗
- Database authentication (user 'libraryuser' cannot connect)
- Application won't start due to database connection failure
- Application not accessible via browser

## Next Steps for Tomorrow

### To-Do List

- [ ] Verify MySQL database user actually exists in the database
- [ ] If user doesn't exist, recreate it with a strong password that meets MySQL policy requirements
- [ ] Grant proper privileges to the user on the library database
- [ ] Test database connection manually using command line before trying the app
- [ ] Verify all three environment variables (DB_HOST, DB_USER, DB_PASS) are properly set
- [ ] Ensure the password in environment variable matches the actual MySQL user password
- [ ] Try starting the Spring Boot application again
- [ ] Configure AWS Security Group to open inbound port 5000
- [ ] Test application access via browser once it starts successfully
- [ ] Document the final working configuration for future reference

## Useful Commands Reference

```bash
# Check if Java is installed
java -version

# Check if Maven is installed
mvn -version

# Check MySQL service status
sudo systemctl status mysql

# View MySQL users
sudo mysql -e "SELECT User, Host FROM mysql.user;"

# Test database connection
mysql -u <username> -p <database_name>

# View environment variables
printenv | grep DB_

# Kill Java processes
pkill -9 java

# Check what's running on port 5000
netstat -tuln | grep 5000
# OR
sudo lsof -i :5000

# View application logs (if running in background with nohup)
tail -f app.log

# Make environment variables permanent (example format)
echo 'export DB_HOST="<your_connection_string>"' >> ~/.bashrc
echo 'export DB_USER="<your_username>"' >> ~/.bashrc
echo 'export DB_PASS="<your_password>"' >> ~/.bashrc
source ~/.bashrc
```

## Server Details
- **Public IP:** [Your EC2 public IP]
- **Private IP:** [Your EC2 private IP]
- **OS:** Ubuntu (AWS EC2)
- **Application Port:** 5000
- **Database:** MySQL on localhost:3306

## Additional Notes
- The application uses Spring Boot DevTools, which enables hot reload during development
- The project includes both JPA repositories and REST controllers
- Database connection pooling is handled by HikariCP
- The application has both web controllers (Thymeleaf templates) and REST API endpoints
